
{% macro fancy_search(text) -%}
    {% set search_phrase = request.args.get('q') %}
    {% for word in text.split() %}
        {% if search_phrase.lower() in word.lower() %}
            <strong style="background-color: greenyellow">{{ word }}</strong>
        {% else %}
            {{ word }}
        {% endif %}
    {% endfor %}
{%- endmacro %}


{% if results %}
{% set search_phrase = request.args.get('q') %}
<div class="questions">
    <div>
        <h2>All Search Results</h2>
        <p>Searched phrase: <em>{{ search_phrase }}</em></p>
        <p>The following results list questions that contain the phrase "{{ search_phrase }}" in
            either a question's title or message, or in an answer's message to a question.</p>
        {% for result in results %}
            <div class="question" style="color: black">
                <ul>
                    <li><a class="questionLink" href="question/{{ result.id }}">
                        <h4>{{ fancy_search( result.title ) }}</h4></a>
                        <p>{{ fancy_search( result.question_message ) }}</p>
                        {% if result.answer_message %}
                            {% if search_phrase.lower() in result.answer_message.lower() %}
                                <hr>
                                <p> Answer messages </p>
                                <p style="margin-left: 50px;"> ---{{ fancy_search(result.answer_message) }}</p>
                            {% endif %}
                        {% endif %}
                    </li>
                </ul>
            </div>
        {% endfor %}
    </div>
</div>
{% elif search_phrase %}
<div class="questions">
    <div class="question" style="color: black">
        <h2>No results found for <em>{{ search_phrase }}</em>.</h2>
        <p>Try a different phrase or check your spelling. </p>
    </div>
</div>
{% endif %}
