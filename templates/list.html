{% extends "layout.html" %}
{% block title %}List Questions{% endblock %}
{% block body %}
    {% from 'macros.html' import search_answers with context  %}
    {% from 'macros.html' import get_tags with context  %}
    {% from 'macros.html' import get_questions with context  %}

    {#    MAIN PAGE     #}
    {% if is_logged_in %}
            <br><em style="text-align: center; color: greenyellow;">{{ username }} logged in </em><br>
    {% endif %}
    <div style="display: flex; flex-direction: row; flex-wrap: wrap; align-items: center; color: whitesmoke;">
        <div style="margin: 25px; padding: 10px;"><a href="/">
            <img class="logo" src="/uploads/logo.jpg" alt="logo" height="100" style="float: left"></a>
        </div>

        <div style="margin: 25px; padding: 10px;">

            {% if results %}
                <h1>Filtered question list </h1></div>
            {% else %}
                <h1>All questions</h1></div>
            {% endif %}

    {% if questions %}
        <div style="margin: 25px; padding: 10px;"><a href="/add-question">Add a question</a><br><br>
            <a href="/registration">Create Account</a><br><br>
            {% if is_logged_in %}
                <a href="{{ url_for('logout') }}">Logout</a>
            {% else %}
                <a href="/login">Login</a>
            {% endif %}
        </div>
        <div style="margin: 25px; padding: 10px;"><label for="order_by"> Sort question list by </label>
            <select style="display: inline;" name="order_by" id="order_by" form="sort">
                <option value="">--Please choose an option--</option>
                <option name="title-asc" value="title-asc">Title &#8679</option>
                <option value="title">Title &#8681</option>
                <option value="view_number-asc">Views &#8679</option>
                <option value="view_number">Views &#8681</option>
            </select>
            <form style="display: inline;" action="/list" method="get" id="sort"><input type="submit"></form>
            <br><small> Questions ordered by {{ order_by }}: {{ order_direction }}</small></div>
        <div>
            <form action="/search" method="GET">
                <label for="submit"><input type="text" name="q" placeholder="Enter a search phrase "></label>
                <input type="submit" value="Search"></form>
        </div></div>
        <div class="item">

        <main>
            {% from 'macros.html' import fancy_search  %}
            {% set search_phrase = request.args.get('q') %}
            {% if not search_phrase %}
                {% for question in questions %}
                    {{ get_questions(question) }}
                {% endfor %}
            {% else %}
                {% if not results and search_phrase %}
                    <div class="questions">
                        <div class="question"><h2>No results found for <em>{{ search_phrase }}</em>.</h2>
                            <p>Try a different phrase or check your spelling. </p></div>
                    </div>
                {% elif results %}
                    <div class="questions">
                        <div class="question">
                            <h2>Search Results</h2>
                            <p>Searched phrase: <em>{{ search_phrase }}</em></p>
                            <p>The following results list questions that contain the phrase "{{ search_phrase }}" in
                                either a question's title or message, or in an answer's message to a question.</p>
                        </div>
                    </div>
                    {% for result in results %}{% for question in questions %}{% if result.id == question.id %}
                                    {{ get_questions(question, search_phrase ) }}
                    {% endif %}{% endfor %}{% endfor %}
                {% endif %}
                </main>
            {% endif %}
    {% else %}
        <p>No questions added yet. <a href="/add-question">Add a question now!</a></p>
        </main>
    {% endif %}
</div>
{% endblock %}